<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>UNITAPP ‚Äì Pet Smart NFC Card</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root{
  --bg1:#020617;--bg2:#0f172a;--accent:#2dd4bf;
  --text:#e5e7eb;--muted:#94a3b8;--danger:#7f1d1d;
}
*{box-sizing:border-box;font-family:Inter,system-ui,sans-serif}
body{margin:0;background:radial-gradient(circle at top,var(--bg2),var(--bg1));color:var(--text)}
.container{max-width:440px;margin:auto;padding:20px}
.card{background:rgba(255,255,255,.06);backdrop-filter:blur(12px);border-radius:22px;padding:20px;margin-bottom:16px}
.hidden{display:none}
button,input,textarea,select{
  width:100%;margin-top:10px;padding:12px;border-radius:12px;
  background:#020617;color:var(--text);
  border:1px solid rgba(255,255,255,.15)
}
button{font-weight:700;cursor:pointer}
.primary{background:var(--accent);color:#022c22}
.link{background:none;border:none;color:var(--accent);text-decoration:underline}
.alert{background:var(--danger);padding:10px;border-radius:10px;text-align:center}
footer{text-align:center;font-size:12px;color:var(--muted)}
footer button{margin:4px}
</style>
</head>

<body>
<div class="container">

<!-- ADMIN DASHBOARD -->
<div id="adminBox" class="card hidden">
  <h2>Admin Dashboard</h2>
  <input id="adminPin" type="password" placeholder="Admin PIN">
  <button class="primary" onclick="loadAdmin()">Enter</button>
  <div id="adminList"></div>
</div>

<!-- PET SELECT -->
<div id="petSwitch" class="card hidden">
  <select id="petSelect" onchange="switchPet()"></select>
</div>

<!-- LOST ALERT -->
<div id="lostAlert" class="alert hidden">üö® PET IS LOST ‚Äì CONTACT OWNER üö®</div>

<!-- VIEW -->
<div id="viewBox" class="card">
  <h2 id="v_name">Loading‚Ä¶</h2>
  <p id="v_type"></p>
  <p id="v_owner"></p>
  <button id="callBtn" class="primary">üìû Call</button>
  <button id="waBtn" class="primary">üí¨ WhatsApp</button>
  <button onclick="showPin()">‚úèÔ∏è Edit</button>
</div>

<!-- PIN -->
<div id="pinBox" class="card hidden">
  <input id="pinInput" type="password" placeholder="Pet PIN">
  <button class="primary" onclick="verifyPin()">Unlock</button>
</div>

<!-- EDIT -->
<div id="editBox" class="card hidden">
  <input id="e_name" placeholder="Pet Name">
  <input id="e_type" placeholder="Pet Type">
  <input id="e_owner" placeholder="Owner Name">
  <input id="e_phone" placeholder="Phone">
  <input id="e_photo" placeholder="Photo URL">
  <label><input type="checkbox" id="e_lost"> Lost</label>
  <input id="e_pin" placeholder="Set / Change PIN">
  <button class="primary" onclick="save()">Save</button>
  <button onclick="cancel()">Cancel</button>
</div>

<!-- TERMS -->
<div id="termsBox" class="card hidden">
  <h3>Terms of Use</h3>
  <p>This service provides pet identification and contact assistance. UNITAPP is not liable for misuse.</p>
</div>

<!-- PRIVACY -->
<div id="privacyBox" class="card hidden">
  <h3>Privacy Policy</h3>
  <p>We store only pet and owner information provided voluntarily. No tracking cookies used.</p>
</div>

<footer>
  <button class="link" onclick="showTerms()">Terms</button>
  <button class="link" onclick="showPrivacy()">Privacy</button>
</footer>

</div>

<script>
/* üî¥ FIREBASE CONFIG üî¥ */
const firebaseConfig={
  apiKey:"PASTE_HERE",
  authDomain:"PASTE_HERE",
  projectId:"PASTE_HERE",
  storageBucket:"PASTE_HERE",
  messagingSenderId:"PASTE_HERE",
  appId:"PASTE_HERE"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

/* GLOBAL */
let petId=new URLSearchParams(location.search).get("pet")||"PET1";
const isAdmin=new URLSearchParams(location.search).get("admin");

/* ADMIN */
async function loadAdmin(){
  if(adminPin.value!=="1234"){alert("Wrong admin PIN");return;}
  adminList.innerHTML="";
  const snap=await db.collection("pets").get();
  snap.forEach(d=>{
    const b=document.createElement("button");
    b.innerText=d.id;
    b.onclick=()=>location.href=`?pet=${d.id}`;
    adminList.appendChild(b);
  });
}

/* LOAD */
async function load(){
  if(isAdmin){adminBox.classList.remove("hidden");return;}
  const doc=await db.collection("pets").doc(petId).get();
  if(!doc.exists)return;
  const d=doc.data();
  v_name.innerText=d.name;
  v_type.innerText=d.type;
  v_owner.innerText=d.owner;
  callBtn.onclick=()=>location.href="tel:"+d.phone;
  waBtn.onclick=()=>location.href="https://wa.me/"+d.phone;
  lostAlert.classList.toggle("hidden",!d.lost);
}
load();

/* EDIT FLOW */
function showPin(){viewBox.classList.add("hidden");pinBox.classList.remove("hidden");}
async function verifyPin(){
  const d=(await db.collection("pets").doc(petId).get()).data();
  if(d.pin && pinInput.value!==d.pin){alert("Wrong PIN");return;}
  pinBox.classList.add("hidden");editBox.classList.remove("hidden");
  e_name.value=d.name||"";e_type.value=d.type||"";e_owner.value=d.owner||"";e_phone.value=d.phone||"";e_photo.value=d.photo||"";e_lost.checked=d.lost||false;
}
async function save(){
  await db.collection("pets").doc(petId).set({
    name:e_name.value,type:e_type.value,owner:e_owner.value,
    phone:e_phone.value,photo:e_photo.value,lost:e_lost.checked,
    pin:e_pin.value||undefined
  },{merge:true});
  location.reload();
}
function cancel(){location.reload();}

/* TERMS */
function showTerms(){termsBox.classList.toggle("hidden");privacyBox.classList.add("hidden");}
function showPrivacy(){privacyBox.classList.toggle("hidden");termsBox.classList.add("hidden");}
</script>
</body>
</html>
