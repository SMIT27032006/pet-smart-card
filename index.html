<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>UNITAPP ‚Äì Pet Smart NFC Card</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  min-height:100vh;
  background:radial-gradient(circle at top,#0f172a,#020617);
  color:#e5e7eb;
  font-family:system-ui,Inter,sans-serif;
  display:flex;
  justify-content:center;
}
.container{max-width:420px;width:100%;padding:20px}
.card{
  background:rgba(255,255,255,.06);
  backdrop-filter:blur(14px);
  border-radius:20px;
  padding:20px;
  margin-bottom:16px;
}
h1{text-align:center;margin:8px 0}
p{text-align:center;color:#94a3b8;margin-top:0}
.avatar{
  width:90px;height:90px;border-radius:50%;
  background:#1e293b;
  margin:0 auto 10px;
  display:flex;align-items:center;justify-content:center;
  overflow:hidden;font-size:40px;
}
.avatar img{width:100%;height:100%;object-fit:cover}
.row{display:flex;justify-content:space-between;margin:6px 0}
label{font-size:13px;color:#94a3b8}
input,textarea{
  width:100%;margin-top:8px;padding:12px;
  border-radius:12px;border:1px solid #334155;
  background:#020617;color:#e5e7eb;
}
button{
  width:100%;margin-top:10px;padding:12px;
  border-radius:14px;border:none;
  background:#2dd4bf;color:#022c22;
  font-weight:700;cursor:pointer;
}
.secondary{background:#020617;border:1px dashed #2dd4bf;color:#2dd4bf}
.actions{display:flex;gap:10px;margin-top:10px}
.actions a{
  flex:1;padding:12px;border-radius:14px;
  background:#2dd4bf;color:#022c22;
  text-align:center;text-decoration:none;font-weight:700;
}
.alert{
  background:#7f1d1d;color:#fecaca;
  padding:10px;border-radius:12px;
  text-align:center;margin-bottom:10px;
}
footer{text-align:center;font-size:12px;color:#94a3b8}
footer span{cursor:pointer;color:#2dd4bf;margin:0 6px}
.hidden{display:none}
</style>
</head>

<body>
<div class="container">

<h1>Pet Smart NFC Card</h1>
<p>One tap can bring me home</p>

<div id="lostAlert" class="alert hidden">
üö® PET IS LOST ‚Äì PLEASE CONTACT OWNER üö®
</div>

<div class="card">
  <div class="avatar" id="photoBox">üêæ</div>

  <div class="row"><label>Name</label><span id="v_name">‚Äî</span></div>
  <div class="row"><label>Type</label><span id="v_type">‚Äî</span></div>
  <div class="row"><label>Owner</label><span id="v_owner">‚Äî</span></div>

  <div class="actions">
    <a id="callBtn">üìû Call</a>
    <a id="waBtn">üí¨ WhatsApp</a>
  </div>

  <button class="secondary" onclick="toggleEdit()">‚úèÔ∏è Edit Details</button>
</div>

<div class="card hidden" id="editBox">
  <input id="e_name" placeholder="Pet Name">
  <input id="e_type" placeholder="Pet Type">
  <input id="e_owner" placeholder="Owner Name">
  <input id="e_phone" placeholder="Mobile Number">
  <input id="e_photo" placeholder="Pet Photo Image URL">
  <textarea id="e_medical" placeholder="Medical info"></textarea>
  <label><input type="checkbox" id="e_lost"> Mark as Lost</label>
  <button onclick="save()">Save</button>
</div>

<footer>
  <span onclick="alert('Basic pet identification service.')">Terms</span> |
  <span onclick="alert('Only data you enter is stored.')">Privacy</span>
</footer>

</div>

<script>
/* FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "PASTE_HERE",
  authDomain: "PASTE_HERE",
  projectId: "PASTE_HERE",
  appId: "PASTE_HERE"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* PET ID */
const petId = new URLSearchParams(window.location.search).get("pet") || "PET001";

/* ELEMENTS */
const v_name = document.getElementById("v_name");
const v_type = document.getElementById("v_type");
const v_owner = document.getElementById("v_owner");
const callBtn = document.getElementById("callBtn");
const waBtn = document.getElementById("waBtn");
const lostAlert = document.getElementById("lostAlert");
const photoBox = document.getElementById("photoBox");

const e_name = document.getElementById("e_name");
const e_type = document.getElementById("e_type");
const e_owner = document.getElementById("e_owner");
const e_phone = document.getElementById("e_phone");
const e_photo = document.getElementById("e_photo");
const e_medical = document.getElementById("e_medical");
const e_lost = document.getElementById("e_lost");

const editBox = document.getElementById("editBox");

/* LOAD DATA */
async function loadPet() {
  try {
    const snap = await db.collection("pets").doc(petId).get();
    if (!snap.exists) {
      console.log("New pet, no data yet");
      return;
    }

    const d = snap.data();

    v_name.innerText = d.name || "‚Äî";
    v_type.innerText = d.type || "‚Äî";
    v_owner.innerText = d.owner || "‚Äî";

    callBtn.href = "tel:" + d.phone;
    waBtn.href = "https://wa.me/" + d.phone;

    lostAlert.classList.toggle("hidden", !d.lost);

    photoBox.innerHTML = d.photo
      ? `<img src="${d.photo}">`
      : "üêæ";

    e_name.value = d.name || "";
    e_type.value = d.type || "";
    e_owner.value = d.owner || "";
    e_phone.value = d.phone || "";
    e_photo.value = d.photo || "";
    e_medical.value = d.medical || "";
    e_lost.checked = d.lost || false;

  } catch (err) {
    console.error("LOAD ERROR:", err);
  }
}

loadPet();

/* EDIT TOGGLE */
function toggleEdit() {
  editBox.classList.toggle("hidden");
}

/* SAVE DATA */
async function save() {
  try {
    await db.collection("pets").doc(petId).set({
      name: e_name.value,
      type: e_type.value,
      owner: e_owner.value,
      phone: e_phone.value,
      photo: e_photo.value,
      medical: e_medical.value,
      lost: e_lost.checked
    });

    alert("Saved successfully");
    editBox.classList.add("hidden");
    loadPet();

  } catch (err) {
    alert("Save failed");
    console.error("SAVE ERROR:", err);
  }
}
</script>

</body>
</html>
